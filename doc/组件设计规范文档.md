# 组件设计规范文档

## 1. 组件分类体系

### 🏗 **组件层次结构**

```
组件体系
├── 基础组件 (Atoms)
│   ├── Button          # 按钮
│   ├── Input           # 输入框
│   ├── Icon            # 图标
│   ├── Tag             # 标签
│   └── Loading         # 加载指示器
├── 复合组件 (Molecules)
│   ├── SearchBox       # 搜索框
│   ├── AssetCard       # 资产卡片
│   ├── UserAvatar      # 用户头像
│   ├── QualityBadge    # 质量徽章
│   └── BreadcrumbNav   # 面包屑导航
├── 业务组件 (Organisms)
│   ├── DataTable       # 数据表格
│   ├── LineageGraph    # 血缘图谱
│   ├── ChartContainer  # 图表容器
│   ├── FilterPanel     # 筛选面板
│   └── ActivityFeed    # 活动流
└── 页面模板 (Templates)
    ├── Layout          # 页面布局
    ├── PageHeader      # 页面头部
    └── ContentArea     # 内容区域
```

## 2. 基础组件规范

### 🔘 **Button 按钮组件**

**组件接口**
```typescript
interface ButtonProps {
  type?: 'primary' | 'secondary' | 'danger' | 'ghost' | 'link';
  size?: 'small' | 'medium' | 'large';
  disabled?: boolean;
  loading?: boolean;
  icon?: React.ReactNode;
  iconPosition?: 'left' | 'right';
  block?: boolean;
  htmlType?: 'button' | 'submit' | 'reset';
  onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void;
  children: React.ReactNode;
  className?: string;
  style?: React.CSSProperties;
}
```

**使用示例**
```jsx
// 主要按钮
<Button type="primary" icon={<PlusIcon />}>
  创建资产
</Button>

// 加载状态
<Button type="primary" loading>
  保存中...
</Button>

// 危险操作
<Button type="danger" size="small">
  删除
</Button>
```

**样式规范**
```scss
.demo-button {
  // 基础样式
  border-radius: 6px;
  font-weight: 500;
  transition: all 0.3s ease;
  cursor: pointer;
  
  // 尺寸规范
  &.size-small {
    padding: 4px 12px;
    font-size: 12px;
    height: 28px;
  }
  
  &.size-medium {
    padding: 8px 16px;
    font-size: 14px;
    height: 36px;
  }
  
  &.size-large {
    padding: 12px 20px;
    font-size: 16px;
    height: 44px;
  }
  
  // 类型样式
  &.type-primary {
    background: linear-gradient(135deg, #1677ff 0%, #4096ff 100%);
    color: white;
    border: none;
    
    &:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(22, 119, 255, 0.3);
    }
  }
  
  &.type-secondary {
    background: white;
    color: #1677ff;
    border: 1px solid #1677ff;
    
    &:hover {
      background: #f0f9ff;
    }
  }
  
  // 加载状态
  &.loading {
    pointer-events: none;
    opacity: 0.7;
  }
  
  // 禁用状态
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
}
```

### 📝 **Input 输入框组件**

**组件接口**
```typescript
interface InputProps {
  type?: 'text' | 'password' | 'email' | 'number' | 'search';
  size?: 'small' | 'medium' | 'large';
  placeholder?: string;
  value?: string;
  defaultValue?: string;
  disabled?: boolean;
  readonly?: boolean;
  maxLength?: number;
  prefix?: React.ReactNode;
  suffix?: React.ReactNode;
  addonBefore?: React.ReactNode;
  addonAfter?: React.ReactNode;
  status?: 'error' | 'warning' | 'success';
  helperText?: string;
  onChange?: (value: string, event: React.ChangeEvent<HTMLInputElement>) => void;
  onFocus?: (event: React.FocusEvent<HTMLInputElement>) => void;
  onBlur?: (event: React.FocusEvent<HTMLInputElement>) => void;
  onPressEnter?: (event: React.KeyboardEvent<HTMLInputElement>) => void;
  className?: string;
  style?: React.CSSProperties;
}
```

**使用示例**
```jsx
// 基础输入框
<Input 
  placeholder="请输入搜索关键词"
  prefix={<SearchIcon />}
  onChange={(value) => console.log(value)}
/>

// 带状态的输入框
<Input 
  status="error"
  helperText="用户名不能为空"
  value={username}
  onChange={setUsername}
/>

// 搜索框样式
<Input 
  type="search"
  size="large"
  placeholder="搜索数据资产、字段、标签..."
  suffix={<Button type="primary" size="small">搜索</Button>}
/>
```

### 🏷 **Tag 标签组件**

**组件接口**
```typescript
interface TagProps {
  color?: 'blue' | 'green' | 'orange' | 'red' | 'purple' | 'gray';
  size?: 'small' | 'medium' | 'large';
  closable?: boolean;
  icon?: React.ReactNode;
  onClick?: () => void;
  onClose?: () => void;
  children: React.ReactNode;
  className?: string;
}
```

**使用示例**
```jsx
// 数据类型标签
<Tag color="blue" icon={<TableIcon />}>
  数据表
</Tag>

// 可关闭标签
<Tag color="green" closable onClose={() => removeTag('用户分析')}>
  用户分析
</Tag>

// 标签组
<div className="tag-group">
  {tags.map(tag => (
    <Tag key={tag} color="gray" size="small">
      {tag}
    </Tag>
  ))}
</div>
```

## 3. 复合组件规范

### 🔍 **SearchBox 搜索框组件**

**组件接口**
```typescript
interface SearchBoxProps {
  placeholder?: string;
  value?: string;
  suggestions?: SearchSuggestion[];
  loading?: boolean;
  disabled?: boolean;
  showAdvanced?: boolean;
  onSearch?: (keyword: string) => void;
  onSuggestionSelect?: (suggestion: SearchSuggestion) => void;
  onAdvancedClick?: () => void;
  onChange?: (value: string) => void;
  className?: string;
}

interface SearchSuggestion {
  text: string;
  type: 'asset' | 'field' | 'tag';
  category: string;
  count?: number;
  icon?: React.ReactNode;
}
```

**使用示例**
```jsx
<SearchBox
  placeholder="搜索数据资产、字段、标签..."
  suggestions={searchSuggestions}
  loading={isSearching}
  showAdvanced={true}
  onSearch={handleSearch}
  onSuggestionSelect={handleSuggestionSelect}
  onAdvancedClick={() => setShowAdvancedSearch(true)}
/>
```

**组件结构**
```jsx
const SearchBox: React.FC<SearchBoxProps> = (props) => {
  return (
    <div className="search-box">
      <div className="search-input-wrapper">
        <Input
          type="search"
          size="large"
          placeholder={props.placeholder}
          prefix={<SearchIcon />}
          suffix={
            <Button type="primary" onClick={() => props.onSearch?.(value)}>
              搜索
            </Button>
          }
          onChange={props.onChange}
        />
        {props.showAdvanced && (
          <Button type="link" onClick={props.onAdvancedClick}>
            高级搜索
          </Button>
        )}
      </div>
      
      {props.suggestions && props.suggestions.length > 0 && (
        <div className="search-suggestions">
          {props.suggestions.map((suggestion, index) => (
            <div
              key={index}
              className="suggestion-item"
              onClick={() => props.onSuggestionSelect?.(suggestion)}
            >
              {suggestion.icon}
              <span className="suggestion-text">{suggestion.text}</span>
              <span className="suggestion-category">{suggestion.category}</span>
              {suggestion.count && (
                <span className="suggestion-count">{suggestion.count}</span>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  );
};
```

### 📋 **AssetCard 资产卡片组件**

**组件接口**
```typescript
interface AssetCardProps {
  asset: {
    id: string;
    name: string;
    type: 'table' | 'model' | 'report' | 'dashboard';
    description?: string;
    owner: {
      name: string;
      avatar?: string;
    };
    tags?: string[];
    qualityScore?: number;
    updateTime?: string;
    accessCount?: number;
  };
  showActions?: boolean;
  onView?: (assetId: string) => void;
  onEdit?: (assetId: string) => void;
  onDelete?: (assetId: string) => void;
  onFavorite?: (assetId: string) => void;
  className?: string;
}
```

**使用示例**
```jsx
<AssetCard
  asset={{
    id: 'asset_001',
    name: '用户行为分析表',
    type: 'table',
    description: '记录用户在平台上的各种行为数据',
    owner: { name: '张三', avatar: '/avatars/zhangsan.jpg' },
    tags: ['用户分析', '行为数据'],
    qualityScore: 95,
    updateTime: '2天前',
    accessCount: 1234
  }}
  showActions={true}
  onView={(id) => navigate(`/assets/${id}`)}
  onEdit={(id) => openEditModal(id)}
/>
```

**组件结构**
```jsx
const AssetCard: React.FC<AssetCardProps> = ({ asset, showActions, ...handlers }) => {
  const getTypeIcon = (type: string) => {
    const icons = {
      table: <TableIcon />,
      model: <ModelIcon />,
      report: <ReportIcon />,
      dashboard: <DashboardIcon />
    };
    return icons[type] || <FileIcon />;
  };

  return (
    <div className="asset-card">
      <div className="card-header">
        <div className="asset-type">
          {getTypeIcon(asset.type)}
          <span className="type-label">{asset.type}</span>
        </div>
        {showActions && (
          <div className="card-actions">
            <Button type="ghost" size="small" onClick={() => handlers.onView?.(asset.id)}>
              查看
            </Button>
            <Button type="link" size="small" onClick={() => handlers.onEdit?.(asset.id)}>
              编辑
            </Button>
          </div>
        )}
      </div>
      
      <div className="card-content">
        <h3 className="asset-name" title={asset.name}>
          {asset.name}
        </h3>
        {asset.description && (
          <p className="asset-description" title={asset.description}>
            {asset.description}
          </p>
        )}
        
        <div className="asset-meta">
          <div className="owner-info">
            <UserAvatar src={asset.owner.avatar} size="small" />
            <span className="owner-name">{asset.owner.name}</span>
          </div>
          {asset.qualityScore && (
            <QualityBadge score={asset.qualityScore} size="small" />
          )}
        </div>
        
        {asset.tags && asset.tags.length > 0 && (
          <div className="asset-tags">
            {asset.tags.slice(0, 3).map(tag => (
              <Tag key={tag} size="small" color="gray">{tag}</Tag>
            ))}
            {asset.tags.length > 3 && (
              <span className="more-tags">+{asset.tags.length - 3}</span>
            )}
          </div>
        )}
      </div>
      
      <div className="card-footer">
        <div className="update-info">
          <ClockIcon />
          <span>{asset.updateTime}</span>
        </div>
        {asset.accessCount && (
          <div className="access-info">
            <EyeIcon />
            <span>{asset.accessCount}次访问</span>
          </div>
        )}
      </div>
    </div>
  );
};
```

### 🎖 **QualityBadge 质量徽章组件**

**组件接口**
```typescript
interface QualityBadgeProps {
  score: number;
  size?: 'small' | 'medium' | 'large';
  showLabel?: boolean;
  onClick?: () => void;
  className?: string;
}
```

**使用示例**
```jsx
// 基础质量徽章
<QualityBadge score={95} />

// 带标签的徽章
<QualityBadge 
  score={88} 
  size="large" 
  showLabel={true}
  onClick={() => openQualityDetails()}
/>
```

## 4. 业务组件规范

### 📊 **DataTable 数据表格组件**

**组件接口**
```typescript
interface DataTableProps<T = any> {
  columns: ColumnDefinition<T>[];
  data: T[];
  loading?: boolean;
  pagination?: {
    current: number;
    pageSize: number;
    total: number;
    showSizeChanger?: boolean;
    showQuickJumper?: boolean;
    onChange?: (page: number, pageSize: number) => void;
  };
  rowSelection?: {
    type: 'checkbox' | 'radio';
    selectedRowKeys?: React.Key[];
    onChange?: (selectedRowKeys: React.Key[], selectedRows: T[]) => void;
  };
  expandable?: {
    expandedRowRender?: (record: T) => React.ReactNode;
    rowExpandable?: (record: T) => boolean;
  };
  onRow?: (record: T) => React.HTMLAttributes<any>;
  scroll?: { x?: number; y?: number };
  className?: string;
}

interface ColumnDefinition<T> {
  key: string;
  title: React.ReactNode;
  dataIndex?: string;
  width?: number | string;
  fixed?: 'left' | 'right';
  align?: 'left' | 'center' | 'right';
  sorter?: boolean | ((a: T, b: T) => number);
  filters?: { text: string; value: any }[];
  onFilter?: (value: any, record: T) => boolean;
  render?: (value: any, record: T, index: number) => React.ReactNode;
  ellipsis?: boolean;
}
```

**使用示例**
```jsx
const columns: ColumnDefinition[] = [
  {
    key: 'name',
    title: '资产名称',
    dataIndex: 'name',
    width: 200,
    fixed: 'left',
    render: (name, record) => (
      <div className="asset-name-cell">
        {getTypeIcon(record.type)}
        <span>{name}</span>
      </div>
    )
  },
  {
    key: 'type',
    title: '类型',
    dataIndex: 'type',
    width: 100,
    filters: [
      { text: '数据表', value: 'table' },
      { text: '数据模型', value: 'model' },
      { text: '报表', value: 'report' }
    ],
    onFilter: (value, record) => record.type === value
  },
  {
    key: 'owner',
    title: '负责人',
    dataIndex: 'owner',
    width: 150,
    render: (owner) => (
      <div className="owner-cell">
        <UserAvatar src={owner.avatar} size="small" />
        <span>{owner.name}</span>
      </div>
    )
  },
  {
    key: 'qualityScore',
    title: '质量评分',
    dataIndex: 'qualityScore',
    width: 120,
    sorter: (a, b) => a.qualityScore - b.qualityScore,
    render: (score) => <QualityBadge score={score} size="small" />
  },
  {
    key: 'actions',
    title: '操作',
    width: 180,
    fixed: 'right',
    render: (_, record) => (
      <div className="action-buttons">
        <Button type="link" size="small" onClick={() => handleView(record.id)}>
          查看
        </Button>
        <Button type="link" size="small" onClick={() => handleEdit(record.id)}>
          编辑
        </Button>
        <Button type="link" size="small" danger onClick={() => handleDelete(record.id)}>
          删除
        </Button>
      </div>
    )
  }
];

<DataTable
  columns={columns}
  data={assets}
  loading={loading}
  pagination={{
    current: currentPage,
    pageSize: 20,
    total: totalCount,
    showSizeChanger: true,
    onChange: (page, size) => handlePageChange(page, size)
  }}
  rowSelection={{
    type: 'checkbox',
    selectedRowKeys: selectedKeys,
    onChange: setSelectedKeys
  }}
  onRow={(record) => ({
    onClick: () => handleRowClick(record),
    onDoubleClick: () => handleView(record.id)
  })}
/>
```

### 🕸 **LineageGraph 血缘图谱组件**

**组件接口**
```typescript
interface LineageGraphProps {
  data: {
    nodes: LineageNode[];
    edges: LineageEdge[];
  };
  centerNodeId?: string;
  direction?: 'upstream' | 'downstream' | 'both';
  maxDepth?: number;
  layout?: 'hierarchical' | 'force' | 'circular';
  onNodeClick?: (node: LineageNode) => void;
  onEdgeClick?: (edge: LineageEdge) => void;
  onNodeHover?: (node: LineageNode | null) => void;
  showMiniMap?: boolean;
  showControls?: boolean;
  className?: string;
}

interface LineageNode {
  id: string;
  name: string;
  type: string;
  level: number;
  position?: { x: number; y: number };
  metadata?: Record<string, any>;
}

interface LineageEdge {
  id: string;
  source: string;
  target: string;
  type: string;
  label?: string;
  confidence?: number;
}
```

**使用示例**
```jsx
<LineageGraph
  data={{
    nodes: lineageNodes,
    edges: lineageEdges
  }}
  centerNodeId="asset_001"
  direction="both"
  maxDepth={3}
  layout="hierarchical"
  showMiniMap={true}
  showControls={true}
  onNodeClick={(node) => openAssetDetails(node.id)}
  onNodeHover={(node) => setHoveredNode(node)}
/>
```

### 📈 **ChartContainer 图表容器组件**

**组件接口**
```typescript
interface ChartContainerProps {
  title?: string;
  type: 'line' | 'bar' | 'pie' | 'area' | 'scatter';
  data: any[];
  config: ChartConfig;
  loading?: boolean;
  empty?: React.ReactNode;
  height?: number;
  onDataPointClick?: (data: any) => void;
  onLegendClick?: (legend: any) => void;
  className?: string;
}

interface ChartConfig {
  xField?: string;
  yField?: string;
  seriesField?: string;
  colorField?: string;
  angleField?: string;
  valueField?: string;
  color?: string | string[] | ((datum: any) => string);
  legend?: boolean | object;
  tooltip?: boolean | object;
  animation?: boolean | object;
  [key: string]: any;
}
```

**使用示例**
```jsx
// 柱状图
<ChartContainer
  title="资产类型分布"
  type="bar"
  data={assetDistributionData}
  config={{
    xField: 'count',
    yField: 'type',
    colorField: 'type',
    legend: false,
    tooltip: {
      formatter: (datum) => ({
        name: datum.type,
        value: `${datum.count} 个`
      })
    }
  }}
  height={300}
  onDataPointClick={(data) => filterByType(data.type)}
/>

// 折线图
<ChartContainer
  title="访问趋势"
  type="line"
  data={accessTrendData}
  config={{
    xField: 'date',
    yField: 'count',
    smooth: true,
    point: { size: 3 },
    tooltip: {
      formatter: (datum) => ({
        name: '访问次数',
        value: datum.count
      })
    }
  }}
  height={200}
/>

// 饼图
<ChartContainer
  title="部门资产分布"
  type="pie"
  data={departmentData}
  config={{
    angleField: 'count',
    colorField: 'department',
    radius: 0.8,
    innerRadius: 0.4,
    label: {
      type: 'spider',
      content: '{name}: {percentage}'
    }
  }}
  height={300}
/>
```

## 5. 页面模板规范

### 🏗 **Layout 页面布局组件**

**组件接口**
```typescript
interface LayoutProps {
  header?: React.ReactNode;
  sidebar?: React.ReactNode;
  footer?: React.ReactNode;
  breadcrumb?: React.ReactNode;
  sidebarCollapsed?: boolean;
  onSidebarToggle?: (collapsed: boolean) => void;
  className?: string;
  children: React.ReactNode;
}
```

**使用示例**
```jsx
<Layout
  header={<TopNavigation />}
  sidebar={<SideNavigation />}
  breadcrumb={<BreadcrumbNav />}
  sidebarCollapsed={sidebarCollapsed}
  onSidebarToggle={setSidebarCollapsed}
>
  <div className="page-content">
    {children}
  </div>
</Layout>
```

### 📄 **PageHeader 页面头部组件**

**组件接口**
```typescript
interface PageHeaderProps {
  title: string;
  subtitle?: string;
  breadcrumb?: React.ReactNode;
  actions?: React.ReactNode;
  tabs?: {
    activeKey: string;
    items: Array<{
      key: string;
      label: string;
      icon?: React.ReactNode;
    }>;
    onChange?: (key: string) => void;
  };
  extra?: React.ReactNode;
  className?: string;
}
```

**使用示例**
```jsx
<PageHeader
  title="资产发现"
  subtitle="发现和管理您的数据资产"
  breadcrumb={<BreadcrumbNav />}
  actions={
    <div className="page-actions">
      <Button type="secondary" icon={<DownloadIcon />}>
        导出
      </Button>
      <Button type="primary" icon={<PlusIcon />}>
        创建资产
      </Button>
    </div>
  }
  tabs={{
    activeKey: activeTab,
    items: [
      { key: 'all', label: '全部资产', icon: <ListIcon /> },
      { key: 'tables', label: '数据表', icon: <TableIcon /> },
      { key: 'models', label: '数据模型', icon: <ModelIcon /> }
    ],
    onChange: setActiveTab
  }}
/>
```

## 6. 状态管理规范

### 🔄 **组件状态类型**

```typescript
// 加载状态
interface LoadingState {
  loading: boolean;
  error?: string | null;
  retry?: () => void;
}

// 分页状态  
interface PaginationState {
  current: number;
  pageSize: number;
  total: number;
}

// 筛选状态
interface FilterState {
  [key: string]: any;
}

// 排序状态
interface SortState {
  field: string;
  order: 'asc' | 'desc';
}

// 选择状态
interface SelectionState {
  selectedKeys: React.Key[];
  selectedRows: any[];
}
```

### 🪝 **自定义Hooks**

```typescript
// 资产列表Hook
const useAssetList = (filters?: FilterState) => {
  const [assets, setAssets] = useState([]);
  const [loading, setLoading] = useState(false);
  const [pagination, setPagination] = useState<PaginationState>({
    current: 1,
    pageSize: 20,
    total: 0
  });

  const loadAssets = useCallback(async (params?: any) => {
    setLoading(true);
    try {
      const response = await assetAPI.getAssets({
        ...filters,
        ...params,
        page: pagination.current,
        pageSize: pagination.pageSize
      });
      setAssets(response.data.list);
      setPagination(prev => ({
        ...prev,
        total: response.data.total
      }));
    } catch (error) {
      console.error('Failed to load assets:', error);
    } finally {
      setLoading(false);
    }
  }, [filters, pagination.current, pagination.pageSize]);

  useEffect(() => {
    loadAssets();
  }, [loadAssets]);

  return {
    assets,
    loading,
    pagination,
    reload: loadAssets,
    changePage: (page: number, pageSize: number) => {
      setPagination(prev => ({ ...prev, current: page, pageSize }));
    }
  };
};

// 搜索Hook
const useSearch = () => {
  const [keyword, setKeyword] = useState('');
  const [suggestions, setSuggestions] = useState([]);
  const [searchLoading, setSearchLoading] = useState(false);

  const getSuggestions = useMemo(
    () => debounce(async (query: string) => {
      if (!query.trim()) {
        setSuggestions([]);
        return;
      }
      
      setSearchLoading(true);
      try {
        const response = await assetAPI.getSearchSuggestions(query);
        setSuggestions(response.data.suggestions);
      } catch (error) {
        console.error('Failed to get suggestions:', error);
      } finally {
        setSearchLoading(false);
      }
    }, 300),
    []
  );

  useEffect(() => {
    getSuggestions(keyword);
  }, [keyword, getSuggestions]);

  return {
    keyword,
    setKeyword,
    suggestions,
    searchLoading,
    clearSuggestions: () => setSuggestions([])
  };
};
```

## 7. 样式命名规范

### 🎨 **BEM命名约定**

```scss
// 块 (Block)
.asset-card { }

// 元素 (Element)  
.asset-card__header { }
.asset-card__content { }
.asset-card__footer { }

// 修饰符 (Modifier)
.asset-card--featured { }
.asset-card--loading { }
.asset-card__header--with-actions { }

// 状态类
.asset-card.is-selected { }
.asset-card.is-hovered { }
.asset-card.is-disabled { }
```

### 📏 **CSS变量使用**

```scss
.demo-component {
  // 使用设计系统变量
  color: var(--text-primary);
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  
  // 组件级变量
  --component-height: 48px;
  --component-padding: var(--space-md);
  
  height: var(--component-height);
  padding: var(--component-padding);
}
```

这套组件设计规范为前端开发团队提供了完整的组件开发指导，确保组件的一致性、可复用性和可维护性，支撑MVP项目的快速开发和后续迭代。 